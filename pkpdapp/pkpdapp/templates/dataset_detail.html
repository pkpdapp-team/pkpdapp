<!--
This file is part of PKPDApp (https://github.com/pkpdapp-team/pkpdapp) which
is released under the BSD 3-clause license. See accompanying LICENSE.md for
copyright notice and full license details.
-->

{% extends "base/base.html" %}
{% load static %}
{% load markdownify %}
{% load plotly_dash %}

{% block main_content %}
<h2>Dataset {{dataset.name}} (<a href="{% url 'dataset-update' dataset.id %}"> Update </a>)</h2>
<ul class="nav nav-tabs" id="datasetTab" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" id="dataset-tab" data-toggle="tab" 
      href="#dataset" role="tab" aria-controls="dataset" 
      aria-selected="true">Metadata</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="data-tab" data-toggle="tab" 
      href="#data" role="tab" aria-controls="data" 
      aria-selected="false">Visualisation</a>
  </li>
  {% if has_doses %}
  <li class="nav-item">
    <a class="nav-link" id="nca-tab" data-toggle="tab" 
      href="#nca" role="tab" aria-controls="nca" 
      aria-selected="false">Non-Compartmental Analysis</a>
  </li>
  {% endif %}
  <li class="nav-item">
    <a class="nav-link" id="data-table-tab" data-toggle="tab" 
      href="#data-table" role="tab" aria-controls="data-table" 
      aria-selected="false">Data Table</a>
  </li>
</ul>
<div class="tab-content" id="datasetTabContent">
  <div class="tab-pane fade show active" id="dataset" role="tabpanel" 
    aria-labelledby="dataset-tab">
    <p>{{dataset.description|markdownify}}</p>
    <h3>Biomarker Types</h2>
    <ul>
    {% for type in biomarker_types %}
      <li>{{ type.name }}: {{ type.description|truncatewords:"10"}}</li>
    {% endfor %}
    </ul>
  </div>
  <div class="tab-pane fade" id="data" role="tabpanel" 
    aria-labelledby="data-tab">
    {% plotly_app_bootstrap name="dataset_view"%}
  </div>
  {% if has_doses %}
  <div class="tab-pane fade" id="nca" role="tabpanel" 
    aria-labelledby="nca-tab">
    {% plotly_app_bootstrap name="nca_view"%}
  </div>
  {% endif %}
  <div class="tab-pane fade" id="data-table" role="tabpanel" 
    aria-labelledby="data-table-tab">
    <h3>Data</h2>
    <table style="width:100%">
      <tr>
        <th>Time</th>
        <th>Subject Id</th>
        <th>Biomarker Type</th>
        <th>Value</th>
      </tr>
      {% for biomarker in biomarker_dataset %}
      <tr>
        <td>{{ biomarker.time }}</td>
        <td>{{ biomarker.subject_id}}</td>
        <td>{{ biomarker.biomarker_type.name }}</td>
        <td>{{ biomarker.value }}</td>
      </tr>
      {% endfor %}
    </table>
    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
            {% endif %}
        </span>
    </div>
  </div>
</div>
{% endblock %}
