<!--
This file is part of PKPDApp (https://github.com/pkpdapp-team/pkpdapp) which
is released under the BSD 3-clause license. See accompanying LICENSE.md for
copyright notice and full license details.
-->

{% extends "base/base.html" %}
{% load static %}
{% load markdownify %}
{% load plotly_dash %}

{% block main_content %}
<p></p>
<h2>Dataset {{dataset.name}}</h2>
(<a href="{% url 'dataset-update' dataset.id %}"> Update dataset </a>)
(<a href="{% url 'dataset-biomarkers-update' dataset.id %}"> Update biomarkers </a>)
<p>{{dataset.description|markdownify}}</p>
<h3>Biomarker Types</h2>
<ul>
{% for type in biomarker_types %}
  <li>{{ type.name }} ({{ type.unit}}): {{ type.description|truncatewords:"10"}}</li>
{% endfor %}
</ul>

<div class="container-fluid">
  <div class="row">
    <div class="col-sm">
      {% plotly_app_bootstrap name="dataset_view" aspect="16by9"%}
    </div>
    {% if has_protocol %}
    <div class="col-sm">
        {% plotly_app_bootstrap name="nca_view" aspect="16by9"%}
    </div>
    {% endif %}
  </div>
</div>

<h3>Protocols</h2>
<table style="width:100%">
  <tr>
    <th>Subject ID</th>
    <th>Compound</th>
  </tr>
  {% for protocol in protocols %}
  <tr>
    <td><a href="{% url 'protocol-detail' protocol.id %}">{{ protocol.subject_id }}</a></td>
    <td>{{ protocol.compound}}</td>
  </tr>
  {% endfor %}
</table>
<div class="pagination">
    <span class="step-links">
        {% if protocol.has_previous %}
            <a href="?page=1">&laquo; first</a>
            <a href="?page={{ protocol.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ protocol.number }} of {{ protocol.paginator.num_pages }}.
        </span>

        {% if protocol.has_next %}
            <a href="?page={{ protocol.next_page_number }}">next</a>
            <a href="?page={{ protocol.paginator.num_pages }}">last &raquo;</a>
        {% endif %}
    </span>
</div>

<h3>Data</h2>
<table style="width:100%">
  <tr>
    <th>Time</th>
    <th>Subject Id</th>
    <th>Biomarker Type</th>
    <th>Value</th>
  </tr>
  {% for biomarker in biomarker_dataset %}
  <tr>
    <td>{{ biomarker.time }}</td>
    <td>{{ biomarker.subject_id}}</td>
    <td>{{ biomarker.biomarker_type.name }}</td>
    <td>{{ biomarker.value }}</td>
  </tr>
  {% endfor %}
</table>
<div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">&laquo; first</a>
            <a href="?page={{ page_obj.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
        {% endif %}
    </span>
</div>
{% endblock %}
